<div class="container mx-auto p-4 md:p-6 mt-4 bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl border border-blue-100 shadow-2xl mb-4 min-h-screen pb-24">
  @if (isOpenPopup) {
    <app-popup
      [message]="popupMessage"
      [type]="popupType"
      (onClose)="closePopup()"
    ></app-popup>
  }
	<!-- Header -->
	<div class="hero bg-gradient-to-r from-blue-50 via-blue-100 to-sky-100 text-blue-900 rounded-xl mb-8 shadow-2xl border border-blue-200">
		<div class="hero-content text-center py-10">
			<div class="max-w-2xl">
				<h1 class="text-4xl font-bold mb-2">Dashboard Amministratore</h1>
				<p class="text-lg opacity-80">Gestione centrale utenti</p>
			</div>
			</div>
		</div>

		<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
		<!-- Left Column - Viewers -->
		<div class="lg:col-span-2 space-y-6">

			<!-- Compagnie -->
			<div class="card bg-white border border-blue-100 shadow-2xl">
				<div class="card-body bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl">
          <div class="flex justify-between items-center mb-4">
            <h2 class="card-title text-2xl text-blue-900 flex items-center gap-2">
              Compagnie
            </h2>
						<div class="flex items-center gap-2">
							  <button class="btn bg-blue-600 hover:bg-blue-700 text-white border-0 shadow-lg btn-sm" (click)="openNuovaCompagnia()">
                Nuova Compagnia
              </button>
            </div>
					</div>

					<div class="overflow-x-auto border border-blue-200 rounded-lg shadow-sm" style="max-height: 300px; overflow-y: auto;">
						<table class="table table-zebra">
							<thead class="sticky top-0 bg-blue-50 z-10">
                <tr class="text-blue-900">
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Email</th>
                    <th>Paese</th>
                    <th>Azioni</th>
                </tr>
							</thead>
							<tbody>
								@if (compagnie && compagnie.length > 0) {
                  @for (c of compagnie; track c.utente) {
                    <tr class="hover:bg-blue-50/50 transition-colors">
                      <td>
                        <div class="font-bold">{{ c.utente }}</div>
                      </td>
											<td>
                        <div class="font-bold">{{ c.nome }}</div>
											</td>
                      <td>
                        <div class="font-semibold">{{ c.email }}</div>
                      </td>
                      <td>
                        <div class="font-semibold">{{ c.nazione }}</div>
                      </td>
                      <td>
                      <button class="btn btn-error btn-xs text-white transition-transform hover:scale-105"
                              (click)="removeCompagnia(c)">
                        Elimina
                      </button>
                      </td>
										</tr>
									}
                  } @else {
									<tr>
                    <td colspan="5" class="text-center py-8">
											<div class="text-blue-700">
												Nessuna compagnia presente
											</div>
										</td>
									</tr>
								}
                @if (isLoadingCompagnie) {
                  @for (r of [0,1,2]; track r) {
                    <tr>
                      <td><div class="skeleton h-4 w-10"></div></td>
                      <td><div class="skeleton h-4 w-40"></div></td>
                      <td><div class="skeleton h-4 w-56"></div></td>
                      <td><div class="skeleton h-4 w-24"></div></td>
                      <td><div class="skeleton h-6 w-20"></div></td>
                    </tr>
                  }
                }
							</tbody>
						</table>
					</div>
				</div>
        <!-- Modal Nuova Compagnia -->
        @if (isNuovaCompagniaOpen) {
          <app-nuova-compagnia [autoOpen]="true" (created)="onCompagniaCreata()" (closed)="isNuovaCompagniaOpen=false"></app-nuova-compagnia>
        }
			</div>

			<!-- Utenti -->
			<div class="card bg-white border border-blue-100 shadow-2xl">
				<div class="card-body bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl">
								<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
									<h2 class="card-title text-2xl text-blue-900 flex items-center gap-2">
										Utenti
									</h2>
									<div class="join w-full md:w-auto">
							<input
								class="input input-bordered join-item border-blue-200 focus:border-blue-500 bg-white w-full md:w-80"
								placeholder="Cerca per ID o Email"
								[value]="searchQuery"
								(input)="onSearchChange($event)"
							/>
              <button class="btn join-item bg-blue-600 hover:bg-blue-700 text-white border-0" (click)="clearSearch()">Reset</button>
						</div>
					</div>

					<div class="overflow-x-auto border border-blue-200 rounded-lg shadow-sm" style="max-height: 300px; overflow-y: auto;">
						<table class="table table-zebra">
              <thead class="sticky top-0 bg-blue-50 z-10">
                <tr class="text-blue-900">
                  <th></th>
                  <th>ID</th>
                  <th>Email</th>
                  <th>Nome</th>
                  <th>Cognome</th>
                  <th>Azioni</th>
                </tr>
              </thead>
							<tbody>
                @if (passeggeriFiltrati && passeggeriFiltrati.length > 0) {
									@for (u of passeggeriFiltrati; track u.utente) {
										<tr class="hover:bg-blue-50/50 transition-colors">
                      <td>
                        <div class="flex items-center gap-3">
                          <div class="avatar">
                            <div class="w-8 h-8 rounded-full overflow-hidden border border-blue-200 bg-blue-50 flex items-center justify-center">
                              @if (u.foto) {
                                <img [src]="getPasseggeroPhoto(u)" class="w-full h-full object-cover" />
                              }
                            </div>
                          </div>
                        </div>
                        <div></div>
                      </td>
                      <td><div class="font-bold">{{ u.utente }}</div></td>
                      <td><div class="font-semibold">{{ u.email }}</div></td>
                      <td><div class="text-sm">{{ u.nome }}</div></td>
                      <td><div class="text-sm">{{ u.cognome }}</div></td>
                      <td>
						          <button class="btn btn-error btn-xs text-white transition-transform hover:scale-105"
                              (click)="removePasseggero(u)">
                        Elimina
                      </button>
                      </td>
                    </tr>
                  }
                } @else {
									<tr>
                    <td colspan="5" class="text-center py-8">
											<div class="text-blue-700">Nessun utente trovato</div>
										</td>
									</tr>
								}
                @if (isLoadingPasseggeri) {
                  @for (r of [0,1,2,3]; track r) {
                    <tr>
                      <td><div class="skeleton h-8 w-8 rounded-full"></div></td>
                      <td><div class="skeleton h-4 w-10"></div></td>
                      <td><div class="skeleton h-4 w-56"></div></td>
                      <td><div class="skeleton h-4 w-24"></div></td>
                      <td><div class="skeleton h-4 w-24"></div></td>
                      <td><div class="skeleton h-6 w-20"></div></td>
                    </tr>
                  }
                }
							</tbody>
						</table>
					</div>
				</div>
			</div>

      <!-- Compagnie in attesa -->
      <div class="card bg-white border border-blue-100 shadow-2xl">
        <div class="card-body bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl">
          <div class="flex items-center justify-between mb-4">
            <h2 class="card-title text-2xl text-blue-900 flex items-center gap-2">Compagnie in attesa</h2>
          </div>
          <div class="overflow-x-auto border border-blue-200 rounded-lg shadow-sm" style="max-height: 300px; overflow-y: auto;">
            <table class="table table-zebra">
              <thead class="sticky top-0 bg-blue-50 z-10">
                <tr class="text-blue-900">
                  <th>ID</th>
                  <th>Email</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                @if (compagnieInAttesa && compagnieInAttesa.length > 0) {
                  @for (c of compagnieInAttesa; track c.utente) {
                    <tr class="hover:bg-blue-50/50 transition-colors">
                      <td><div class="font-bold">{{ c.utente }}</div></td>
                      <td><div class="font-semibold">{{ c.email }}</div></td>
                      <td>
                        <button class="btn btn-error btn-xs text-white transition-transform hover:scale-105" (click)="removeCompagniaInAttesa(c)">Cancella invito</button>
                      </td>
                    </tr>
                  }
                } @else {
                  <tr>
                    <td colspan="3" class="text-center py-8">
                      <div class="text-blue-700">Nessuna compagnia in attesa</div>
                    </td>
                  </tr>
                }
                @if (isLoadingCompagnieInAttesa) {
                  @for (r of [0,1,2]; track r) {
                    <tr>
                      <td><div class="skeleton h-4 w-10"></div></td>
                      <td><div class="skeleton h-4 w-56"></div></td>
                    </tr>
                  }
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
		</div>

		<!-- Right Column - Quick Stats -->
		<div class="space-y-6">
			<div class="card bg-white border border-blue-100 shadow-2xl">
				<div class="card-body bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl">
					<h3 class="card-title mb-4 text-blue-900">Statistiche Rapide</h3>
					<div class="space-y-4">
						<div class="flex justify-between items-center">
							<span class="text-sm font-medium text-blue-800">Totale Compagnie</span>
							  <div class="text-sm font-medium text-blue-800">{{ compagnie.length || 0 }}</div>
						</div>
						<div class="flex justify-between items-center">
							<span class="text-sm font-medium text-blue-800">Totale Utenti</span>
							  <div class="text-sm font-medium text-blue-800">{{ passeggeri.length || 0 }}</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Azioni rapide -->
			<div class="card bg-white border border-blue-100 shadow-2xl">
				<div class="card-body bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl">
					<h3 class="card-title mb-4 text-blue-900">Azioni rapide</h3>
          <div class="grid grid-cols-2 gap-3">
						<button class="btn btn-sm bg-blue-600 hover:bg-blue-700 text-white border-0 shadow" (click)="openNuovaCompagnia()">Nuova Compagnia</button>
						<button class="btn btn-sm border-blue-200" (click)="refreshCompagnie()">Ricarica Compagnie</button>
						<button class="btn btn-sm border-blue-200" (click)="refreshPasseggeri()">Ricarica Utenti</button>
            <button class="btn btn-sm border-blue-200" (click)="refreshCompagnieInAttesa()">Ricarica In Attesa</button>
					</div>
				</div>
			</div>

			<!-- Suggerimenti -->
			<div class="card bg-white border border-blue-100 shadow-2xl">
				<div class="card-body bg-gradient-to-br from-blue-50 via-white to-sky-50 rounded-2xl">
					<h3 class="card-title mb-4 text-blue-900">Suggerimenti</h3>
					<ul class="list-disc list-inside text-sm text-blue-900/90 space-y-2">
            <li>Filtra rapidamente gli utenti con la ricerca per <span class="font-semibold">ID</span> o <span class="font-semibold">email</span>.</li>
            <li>Controlla regolarmente le <span class="font-semibold">compagnie in attesa</span> e gestiscile con le azioni dedicate.</li>
            <li>Ricorda di eseguire un <span class="font-semibold">backup</span> periodico dei dati.</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

